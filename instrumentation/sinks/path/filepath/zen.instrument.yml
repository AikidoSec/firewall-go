meta:
  name: path/filepath
  description: Protection from Local File Inclusion (LFI) Attacks.

rules:
  # Inject go:linkname declaration for Examine
  - id: filepath.Examine.linkname
    type: inject-decl
    package: path/filepath
    anchor: Join
    links:
      - github.com/AikidoSec/firewall-go/instrumentation/sinks/path/filepath
    template: |
      //go:linkname __aikido_filepath_Examine github.com/AikidoSec/firewall-go/instrumentation/sinks/path/filepath.Examine
      func __aikido_filepath_Examine([]string) error

  - id: filepath.Join
    type: prepend
    package: path/filepath
    function: Join
    template: |
      __aikido_filepath_Examine({{ .Function.Argument 0 }})
