# yaml-language-server: $schema=https://datadoghq.dev/orchestrion/schema.json
meta:
  name: github.com/AikidoSec/firewall-go/instrumentation/sinks/path
  description: |-
    Protection from Local File Inclusion (LFI) Attacks
aspects:
  - id: PathExamine-Declaration
    join-point:
      all-of:
        - import-path: path
        - function-body:
            function:
              - name: Join
    advice:
      - inject-declarations:
          # We're using go:linkname to avoid circular dependencies with `path`.
          # We attach the declaration to Join to ensure it's included.
          links:
            - github.com/AikidoSec/firewall-go/instrumentation/sinks/path
          template: |-
            //go:linkname __aikido_path_Examine github.com/AikidoSec/firewall-go/instrumentation/sinks/path.Examine
            func __aikido_path_Examine([]string) error
  - id: JoinPath
    join-point:
      all-of:
        - import-path: path
        - function-body:
            function:
              - name: Join
    advice:
      - prepend-statements:
          template: |-
            __aikido_path_Examine({{ .Function.Argument 0 }})
