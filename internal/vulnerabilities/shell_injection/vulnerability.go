package shell_injection

import (
	"github.com/AikidoSec/firewall-go/internal/types"
	"github.com/AikidoSec/firewall-go/internal/vulnerabilities"
)

var ShellInjectionVulnerability = vulnerabilities.Vulnerability{
	ScanFunction: scanFunction,
	Kind:         types.Shell_injection,
	Error:        "A shell injection has been blocked.",
}

func scanFunction(userInput string, args []string) *vulnerabilities.ScanResult {
	if len(args) != 1 {
		return nil
	}
	var command = args[0]

	if DetectShellInjection(command, userInput) {
		return &vulnerabilities.ScanResult{
			DetectedAttack: true,
			Metadata: map[string]string{
				"command": command,
			},
		}
	}
	return nil
}
